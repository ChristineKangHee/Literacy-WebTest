<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>글랑 문해력 미니 테스트</title>
<style>
  :root{
    --tap: 44px; /* 모바일 접근성 최소 터치 크기 */
  }
  html,body{height:100%;margin:0;background:#E5E8F1;}
  body{display:flex;align-items:center;justify-content:center;}
  /* 화면 컨테이너: 내부 비율 유지 + 이미지 꽉 채우기 */
  .stage{
    position:relative;
    width:min(100vw, 768px);
    height:100svh;          /* iOS safe area 반영 */
    max-height:1600px;      /* 데스크탑 긴 화면에서 과도 확장 방지 */
    overflow:hidden;
    background:#E5E8F1;
  }
  .bg{
    position:absolute; inset:0;
    background:#E5E8F1 center/contain no-repeat;
  }
  /* 핫스팟: 투명 버튼 */
  .hotspot{
    position:absolute;
    display:block;
    border:none; background:transparent; padding:0; margin:0;
    cursor:pointer;
    /* iOS 클릭 편의 */
    min-width:var(--tap); min-height:var(--tap);
    touch-action:manipulation;
  }
  /* 접근성: 포커스 링 */
  .hotspot:focus-visible{ outline:2px dashed rgba(40,120,255,.8); outline-offset:2px; border-radius:12px; }

  /* 디버그 모드: ?debug=1 또는 키보드 D */
  .debug .hotspot{ outline:1px dashed rgba(0,0,0,.25); background:rgba(0,128,255,.08); }
  .debug .hotspot::after{
    content:attr(aria-label);
    position:absolute; left:0; top:-1.6em;
    font:600 12px/1.2 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto;
    color:#0b61ff; background:#fff; border:1px solid #cfe3ff; border-radius:6px; padding:.15em .4em;
    white-space:nowrap; pointer-events:none;
  }

  /* 하단 토스트(정답/선택 피드백 - 필요 시) */
  .toast{
    position:absolute; left:50%; transform:translateX(-50%);
    bottom:18px; padding:.7em 1em; border-radius:10px;
    font:600 14px/1.2 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto;
    color:#1b2b4a; background:#fff; box-shadow:0 8px 32px rgba(0,0,0,.08);
    display:none;
  }
  .toast.show{ display:block; }
</style>
</head>
<body>
  <main id="app" class="stage" aria-live="polite">
    <div id="bg" class="bg"></div>
    <!-- JS가 hotspot 버튼을 주입합니다 -->
    <div id="toast" class="toast"></div>
  </main>

<script>
/* --------------------------
   0) 유틸
---------------------------*/
const $ = sel => document.querySelector(sel);
const params = new URLSearchParams(location.search);
const DEBUG = params.get('debug') === '1';
if (DEBUG) document.body.classList.add('debug');
window.addEventListener('keydown', e=>{
  if (e.key.toLowerCase() === 'd') document.body.classList.toggle('debug');
});

/* --------------------------
   1) 테스트 데이터 (이미지 + 핫스팟)
   - 좌표계: 퍼센트 단위 {x, y, w, h} (stage 기준)
   - 이미지 위 위치만 조정하면 전 기종 대응
   - 필요 버튼만 만들었고, 나머지는 전부 이미지
---------------------------*/

/** 좌표 헬퍼: 보기 좋게 (%) */
const box = (x,y,w,h)=>({x,y,w,h});
/** 공용 핸들러 이름들: 'next', 'answer:o', 'answer:x', 'share', 'restart', 'instagram', 'glang' 등 */

/* 질문 정답(예시): 실 점수 로직은 자유 편집. */
const correct = {
  q1: 'x',
  q2: '오늘',      // 보기 텍스트형일 때 예시
  q3: '요약 훈련이 필요하다',
  q4: 'o',
  q5: '할 수 있다',
  q6: 'x',
  q7: '전제가 잘못됐다',
  q8: '읽고 이해·비판·표현하는 종합 능력'
};

/* 화면 시퀀스 */
const screens = [
  /* 0) 인트로 */
  {
    id: 'intro',
    img: 'assets/intro.jpg',
    hotspots: [
      { id:'start', label:'START', rect: box(22,73,56,7), on:'next' },     // Start 버튼
    ]
  },

  /* 1) Q1 (OX 예시) */
  {
    id: 'q1',
    img: 'assets/q1.jpg', // = iPhone 16 Pro Max - 3.jpg
    hotspots: [
      { id:'q1_o', label:'O', rect: box(5,47,90,8), on:'answer:o' },
      { id:'q1_x', label:'X', rect: box(5,57,90,8), on:'answer:x' },
    ]
  },

  /* 2) Q2 (객관식 4지) */
  {
    id: 'q2',
    img: 'assets/q2.jpg',
    hotspots: [
      { id:'q2_a', label:'오늘',   rect: box(5,37,90,8), on:'answer:오늘' },
      { id:'q2_b', label:'내일',   rect: box(5,47,90,8), on:'answer:내일' },
      { id:'q2_c', label:'이번 주', rect: box(5,58,90,8), on:'answer:이번 주' },
      { id:'q2_d', label:'요즘',   rect: box(5,68,90,8), on:'answer:요즘' },
    ]
  },

  /* 3) Q3 */
  {
    id: 'q3',
    img: 'assets/q3.jpg',
    hotspots: [
      { id:'q3_a', label:'긴 글은 읽지 말자', rect: box(5,41,90,8), on:'answer:긴 글은 읽지 말자' },
      { id:'q3_b', label:'요약 훈련이 필요하다', rect: box(5,51,90,8), on:'answer:요약 훈련이 필요하다' },
      { id:'q3_c', label:'모든 글을 똑같이 읽어야 한다', rect: box(5,62,90,8), on:'answer:모든 글을 똑같이 읽어야 한다' },
      { id:'q3_d', label:'짧은 글은 쉬운 글이다', rect: box(5,72,90,8), on:'answer:짧은 글은 쉬운 글이다' },
    ]
  },

  /* 4) Q4 (OX) */
  {
    id: 'q4',
    img: 'assets/q4.jpg',
    hotspots: [
      { id:'q4_o', label:'O', rect: box(5,48,90,8), on:'answer:o' },
      { id:'q4_x', label:'X', rect: box(5,59,90,8), on:'answer:x' },
    ]
  },

  /* 5) Q5 (맞춤법 4지) */
  {
    id: 'q5',
    img: 'assets/q5.jpg',
    hotspots: [
      { id:'q5_a', label:'할 수 있다', rect: box(5,38,90,8), on:'answer:할 수 있다' },
      { id:'q5_b', label:'할수있다',   rect: box(5,48,90,8), on:'answer:할수있다' },
      { id:'q5_c', label:'할수 있다',  rect: box(5,59,90,8), on:'answer:할수 있다' },
      { id:'q5_d', label:'할 수있다', rect: box(5,69,90,8), on:'answer:할 수있다' },
    ]
  },

  /* 6) Q6 (OX) */
  {
    id: 'q6',
    img: 'assets/q6.jpg',
    hotspots: [
      { id:'q6_o', label:'O', rect: box(5,48,90,8), on:'answer:o' },
      { id:'q6_x', label:'X', rect: box(5,59,90,8), on:'answer:x' },
    ]
  },

  /* 7) Q7 (논리) */
  {
    id: 'q7',
    img: 'assets/q7.jpg',
    hotspots: [
      { id:'q7_a', label:'사실과 의견이 섞였다', rect: box(5,38,90,8), on:'answer:사실과 의견이 섞였다' },
      { id:'q7_b', label:'전제가 잘못됐다',     rect: box(5,48,90,8), on:'answer:전제가 잘못됐다' },
      { id:'q7_c', label:'논리적으로 완벽하다', rect: box(5,59,90,8), on:'answer:논리적으로 완벽하다' },
      { id:'q7_d', label:'결론이 적절하다',     rect: box(5,69,90,8), on:'answer:결론이 적절하다' },
    ]
  },

  /* 8) Q8 (정의) */
  {
    id: 'q8',
    img: 'assets/q8.jpg',
    hotspots: [
      { id:'q8_a', label:'글을 읽고 쓸 수 있는 능력',         rect: box(5,38,90,8), on:'answer:글을 읽고 쓸 수 있는 능력' },
      { id:'q8_b', label:'읽고 이해·비판·표현하는 종합 능력', rect: box(5,48,90,8), on:'answer:읽고 이해·비판·표현하는 종합 능력' },
      { id:'q8_c', label:'글자를 많이 아는 능력',             rect: box(5,59,90,8), on:'answer:글자를 많이 아는 능력' },
      { id:'q8_d', label:'긴 글을 끝까지 읽는 끈기',           rect: box(5,69,90,8), on:'answer:긴 글을 끝까지 읽는 끈기' },
    ]
  },

  /* 9) 결과 (예시: Expression Creator 이미지) */
  {
    id: 'result',
    // 아래는 기본 결과 이미지. 실제 결과에 따라 JS가 바꿔치기 함.
    img: 'assets/result_expression.jpg',
    hotspots: [
      { id:'share',     label:'SHARE',     rect: box(17,80,30,6), on:'share' },
      { id:'restart',   label:'RESTART',   rect: box(53,80,30,6), on:'restart' },
      { id:'instagram', label:'Instagram', rect: box(40,89,8,5),  on:'instagram' },
      { id:'glang',     label:'Glang Logo',rect: box(50,89,8,5),  on:'glang' },
    ]
  }
];

/* --------------------------
   2) 상태 & 진행
---------------------------*/
const state = {
  index: 0,
  answers: {} // { q1:'x', q2:'오늘', ... }
};

const $bg = $('#bg');
const $stage = $('#app');
const $toast = $('#toast');

function showToast(msg, t=1100){
  $toast.textContent = msg;
  $toast.classList.add('show');
  setTimeout(()=> $toast.classList.remove('show'), t);
}

function render(){
  const scr = screens[state.index];
  if (!scr) return;

  // 배경 세팅
  $bg.style.backgroundImage = `url("${scr.img}")`;

  // 기존 핫스팟 제거
  $stage.querySelectorAll('.hotspot').forEach(el=>el.remove());

  // 핫스팟 주입
  scr.hotspots.forEach(h=>{
    const btn = document.createElement('button');
    btn.className = 'hotspot';
    btn.setAttribute('aria-label', h.label || h.id);

    // 퍼센트 좌표 -> style
    const {x,y,w,h:hh} = h.rect;
    Object.assign(btn.style, {
      left:  x + '%',
      top:   y + '%',
      width: w + '%',
      height: hh + '%',
      borderRadius: '12px'
    });

    // 이벤트
    btn.addEventListener('click', ()=>handle(h.on));
    $stage.appendChild(btn);
  });
}

function next(){
  state.index++;
  // 질문을 모두 끝냈다면 결과로
  if (state.index >= screens.length - 1) {
    state.index = screens.length - 1;
    // 결과 이미지 선택
    const resultKey = chooseResult(state.answers);
    const resultImg = resultImageByKey(resultKey);
    screens[state.index].img = resultImg;
  }
  render();
}

function handle(action){
  // on:"answer:값" | "next" | "share" | "restart" | "instagram" | "glang"
  if (!action) return;
  if (action === 'next') { next(); return; }

  if (action.startsWith('answer:')){
    const val = action.split(':')[1];
    const qid = screens[state.index].id; // "q1"~"q8"
    state.answers[qid] = val;
    // // 간단 피드백(원하면 제거)
    // if (correct[qid] !== undefined) {
    //   const ok = correct[qid] === val;
    //   showToast(ok ? '👍 정답' : '오답');
    // }
    next();
    return;
  }

  if (action === 'share') {
    const shareData = {
      title: '글랑 문해력 미니 테스트',
      text: '나의 문해력 캐릭터를 확인했어요! 글랑과 함께 성장해요 💫',
      url: location.origin + location.pathname
    };
    if (navigator.share) navigator.share(shareData).catch(()=>{});
    else {
      navigator.clipboard?.writeText(shareData.url);
      showToast('링크가 복사되었어요');
    }
    return;
  }

  if (action === 'restart') {
    state.index = 0;
    state.answers = {};
    render();
    return;
  }

  if (action === 'instagram') {
    window.open('https://www.instagram.com/', '_blank', 'noopener');
    return;
  }

  if (action === 'glang') {
    window.open('https://glang.app', '_blank', 'noopener');
    return;
  }
}

/* --------------------------
   3) 결과 산출 (심플 룰, 자유 교체)
   - 예시: 정답 수 기반으로 6개 결과에 매핑
   - 실제 서비스 룰로 교체만 하면 됨.
---------------------------*/
function chooseResult(answers){
  // 정답 개수
  let score = 0;
  Object.keys(correct).forEach(k=>{
    if (answers[k] === correct[k]) score++;
  });

  // 6개 유형 예시 매핑
  // (원하는 룰로 재매핑하세요)
  if (score >= 7) return 'expression';
  if (score === 6) return 'logic';
  if (score === 5) return 'focus';
  if (score === 4) return 'vocab';
  if (score === 3) return 'grammar';
  return 'comp';
}

function resultImageByKey(key){
  const map = {
    expression: 'assets/expression.jpg',
    logic:      'assets/logic.jpg',
    focus:      'assets/focus.jpg',
    vocab:      'assets/vocab.jpg',
    grammar:    'assets/grammar.jpg',
    comp:       'assets/compreh.jpg'
  };
  return map[key] || map.expression;
}

/* --------------------------
   4) 시작
---------------------------*/
render();
</script>
</body>
</html>
