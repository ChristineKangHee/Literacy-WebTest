<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>ê¸€ë‘ ë¬¸í•´ë ¥ ë¯¸ë‹ˆ í…ŒìŠ¤íŠ¸</title>
<style>
  :root{
    --tap: 44px; /* ëª¨ë°”ì¼ ì ‘ê·¼ì„± ìµœì†Œ í„°ì¹˜ í¬ê¸° */
  }
  html,body{height:100%;margin:0;background:#E5E8F1;}
  body{display:flex;align-items:center;justify-content:center;}
  /* í™”ë©´ ì»¨í…Œì´ë„ˆ: ë‚´ë¶€ ë¹„ìœ¨ ìœ ì§€ + ì´ë¯¸ì§€ ê½‰ ì±„ìš°ê¸° */
  .stage{
    position:relative;
    width:min(100vw, 768px);
    height:100svh;          /* iOS safe area ë°˜ì˜ */
    max-height:1600px;      /* ë°ìŠ¤í¬íƒ‘ ê¸´ í™”ë©´ì—ì„œ ê³¼ë„ í™•ì¥ ë°©ì§€ */
    overflow:hidden;
    background:#E5E8F1;
  }
  .bg{
    position:absolute; inset:0;
    background:#E5E8F1 center/contain no-repeat;
  }
  /* í•«ìŠ¤íŒŸ: íˆ¬ëª… ë²„íŠ¼ */
  .hotspot{
    position:absolute;
    display:block;
    border:none; background:transparent; padding:0; margin:0;
    cursor:pointer;
    /* iOS í´ë¦­ í¸ì˜ */
    min-width:var(--tap); min-height:var(--tap);
    touch-action:manipulation;
  }
  /* ì ‘ê·¼ì„±: í¬ì»¤ìŠ¤ ë§ */
  .hotspot:focus-visible{ outline:2px dashed rgba(40,120,255,.8); outline-offset:2px; border-radius:12px; }

  /* ë””ë²„ê·¸ ëª¨ë“œ: ?debug=1 ë˜ëŠ” í‚¤ë³´ë“œ D */
  .debug .hotspot{ outline:1px dashed rgba(0,0,0,.25); background:rgba(0,128,255,.08); }
  .debug .hotspot::after{
    content:attr(aria-label);
    position:absolute; left:0; top:-1.6em;
    font:600 12px/1.2 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto;
    color:#0b61ff; background:#fff; border:1px solid #cfe3ff; border-radius:6px; padding:.15em .4em;
    white-space:nowrap; pointer-events:none;
  }

  /* í•˜ë‹¨ í† ìŠ¤íŠ¸(ì •ë‹µ/ì„ íƒ í”¼ë“œë°± - í•„ìš” ì‹œ) */
  .toast{
    position:absolute; left:50%; transform:translateX(-50%);
    bottom:18px; padding:.7em 1em; border-radius:10px;
    font:600 14px/1.2 ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto;
    color:#1b2b4a; background:#fff; box-shadow:0 8px 32px rgba(0,0,0,.08);
    display:none;
  }
  .toast.show{ display:block; }
</style>
</head>
<body>
  <main id="app" class="stage" aria-live="polite">
    <div id="bg" class="bg"></div>
    <!-- JSê°€ hotspot ë²„íŠ¼ì„ ì£¼ì…í•©ë‹ˆë‹¤ -->
    <div id="toast" class="toast"></div>
  </main>

<script>
/* --------------------------
   0) ìœ í‹¸
---------------------------*/
const $ = sel => document.querySelector(sel);
const params = new URLSearchParams(location.search);
const DEBUG = params.get('debug') === '1';
if (DEBUG) document.body.classList.add('debug');
window.addEventListener('keydown', e=>{
  if (e.key.toLowerCase() === 'd') document.body.classList.toggle('debug');
});

/* --------------------------
   1) í…ŒìŠ¤íŠ¸ ë°ì´í„° (ì´ë¯¸ì§€ + í•«ìŠ¤íŒŸ)
   - ì¢Œí‘œê³„: í¼ì„¼íŠ¸ ë‹¨ìœ„ {x, y, w, h} (stage ê¸°ì¤€)
   - ì´ë¯¸ì§€ ìœ„ ìœ„ì¹˜ë§Œ ì¡°ì •í•˜ë©´ ì „ ê¸°ì¢… ëŒ€ì‘
   - í•„ìš” ë²„íŠ¼ë§Œ ë§Œë“¤ì—ˆê³ , ë‚˜ë¨¸ì§€ëŠ” ì „ë¶€ ì´ë¯¸ì§€
---------------------------*/

/** ì¢Œí‘œ í—¬í¼: ë³´ê¸° ì¢‹ê²Œ (%) */
const box = (x,y,w,h)=>({x,y,w,h});
/** ê³µìš© í•¸ë“¤ëŸ¬ ì´ë¦„ë“¤: 'next', 'answer:o', 'answer:x', 'share', 'restart', 'instagram', 'glang' ë“± */

/* ì§ˆë¬¸ ì •ë‹µ(ì˜ˆì‹œ): ì‹¤ ì ìˆ˜ ë¡œì§ì€ ììœ  í¸ì§‘. */
const correct = {
  q1: 'x',
  q2: 'ì˜¤ëŠ˜',      // ë³´ê¸° í…ìŠ¤íŠ¸í˜•ì¼ ë•Œ ì˜ˆì‹œ
  q3: 'ìš”ì•½ í›ˆë ¨ì´ í•„ìš”í•˜ë‹¤',
  q4: 'o',
  q5: 'í•  ìˆ˜ ìˆë‹¤',
  q6: 'x',
  q7: 'ì „ì œê°€ ì˜ëª»ëë‹¤',
  q8: 'ì½ê³  ì´í•´Â·ë¹„íŒÂ·í‘œí˜„í•˜ëŠ” ì¢…í•© ëŠ¥ë ¥'
};

/* í™”ë©´ ì‹œí€€ìŠ¤ */
const screens = [
  /* 0) ì¸íŠ¸ë¡œ */
  {
    id: 'intro',
    img: 'assets/intro.jpg',
    hotspots: [
      { id:'start', label:'START', rect: box(22,73,56,7), on:'next' },     // Start ë²„íŠ¼
    ]
  },

  /* 1) Q1 (OX ì˜ˆì‹œ) */
  {
    id: 'q1',
    img: 'assets/q1.jpg', // = iPhone 16 Pro Max - 3.jpg
    hotspots: [
      { id:'q1_o', label:'O', rect: box(5,47,90,8), on:'answer:o' },
      { id:'q1_x', label:'X', rect: box(5,57,90,8), on:'answer:x' },
    ]
  },

  /* 2) Q2 (ê°ê´€ì‹ 4ì§€) */
  {
    id: 'q2',
    img: 'assets/q2.jpg',
    hotspots: [
      { id:'q2_a', label:'ì˜¤ëŠ˜',   rect: box(5,37,90,8), on:'answer:ì˜¤ëŠ˜' },
      { id:'q2_b', label:'ë‚´ì¼',   rect: box(5,47,90,8), on:'answer:ë‚´ì¼' },
      { id:'q2_c', label:'ì´ë²ˆ ì£¼', rect: box(5,58,90,8), on:'answer:ì´ë²ˆ ì£¼' },
      { id:'q2_d', label:'ìš”ì¦˜',   rect: box(5,68,90,8), on:'answer:ìš”ì¦˜' },
    ]
  },

  /* 3) Q3 */
  {
    id: 'q3',
    img: 'assets/q3.jpg',
    hotspots: [
      { id:'q3_a', label:'ê¸´ ê¸€ì€ ì½ì§€ ë§ì', rect: box(5,41,90,8), on:'answer:ê¸´ ê¸€ì€ ì½ì§€ ë§ì' },
      { id:'q3_b', label:'ìš”ì•½ í›ˆë ¨ì´ í•„ìš”í•˜ë‹¤', rect: box(5,51,90,8), on:'answer:ìš”ì•½ í›ˆë ¨ì´ í•„ìš”í•˜ë‹¤' },
      { id:'q3_c', label:'ëª¨ë“  ê¸€ì„ ë˜‘ê°™ì´ ì½ì–´ì•¼ í•œë‹¤', rect: box(5,62,90,8), on:'answer:ëª¨ë“  ê¸€ì„ ë˜‘ê°™ì´ ì½ì–´ì•¼ í•œë‹¤' },
      { id:'q3_d', label:'ì§§ì€ ê¸€ì€ ì‰¬ìš´ ê¸€ì´ë‹¤', rect: box(5,72,90,8), on:'answer:ì§§ì€ ê¸€ì€ ì‰¬ìš´ ê¸€ì´ë‹¤' },
    ]
  },

  /* 4) Q4 (OX) */
  {
    id: 'q4',
    img: 'assets/q4.jpg',
    hotspots: [
      { id:'q4_o', label:'O', rect: box(5,48,90,8), on:'answer:o' },
      { id:'q4_x', label:'X', rect: box(5,59,90,8), on:'answer:x' },
    ]
  },

  /* 5) Q5 (ë§ì¶¤ë²• 4ì§€) */
  {
    id: 'q5',
    img: 'assets/q5.jpg',
    hotspots: [
      { id:'q5_a', label:'í•  ìˆ˜ ìˆë‹¤', rect: box(5,38,90,8), on:'answer:í•  ìˆ˜ ìˆë‹¤' },
      { id:'q5_b', label:'í• ìˆ˜ìˆë‹¤',   rect: box(5,48,90,8), on:'answer:í• ìˆ˜ìˆë‹¤' },
      { id:'q5_c', label:'í• ìˆ˜ ìˆë‹¤',  rect: box(5,59,90,8), on:'answer:í• ìˆ˜ ìˆë‹¤' },
      { id:'q5_d', label:'í•  ìˆ˜ìˆë‹¤', rect: box(5,69,90,8), on:'answer:í•  ìˆ˜ìˆë‹¤' },
    ]
  },

  /* 6) Q6 (OX) */
  {
    id: 'q6',
    img: 'assets/q6.jpg',
    hotspots: [
      { id:'q6_o', label:'O', rect: box(5,48,90,8), on:'answer:o' },
      { id:'q6_x', label:'X', rect: box(5,59,90,8), on:'answer:x' },
    ]
  },

  /* 7) Q7 (ë…¼ë¦¬) */
  {
    id: 'q7',
    img: 'assets/q7.jpg',
    hotspots: [
      { id:'q7_a', label:'ì‚¬ì‹¤ê³¼ ì˜ê²¬ì´ ì„ì˜€ë‹¤', rect: box(5,38,90,8), on:'answer:ì‚¬ì‹¤ê³¼ ì˜ê²¬ì´ ì„ì˜€ë‹¤' },
      { id:'q7_b', label:'ì „ì œê°€ ì˜ëª»ëë‹¤',     rect: box(5,48,90,8), on:'answer:ì „ì œê°€ ì˜ëª»ëë‹¤' },
      { id:'q7_c', label:'ë…¼ë¦¬ì ìœ¼ë¡œ ì™„ë²½í•˜ë‹¤', rect: box(5,59,90,8), on:'answer:ë…¼ë¦¬ì ìœ¼ë¡œ ì™„ë²½í•˜ë‹¤' },
      { id:'q7_d', label:'ê²°ë¡ ì´ ì ì ˆí•˜ë‹¤',     rect: box(5,69,90,8), on:'answer:ê²°ë¡ ì´ ì ì ˆí•˜ë‹¤' },
    ]
  },

  /* 8) Q8 (ì •ì˜) */
  {
    id: 'q8',
    img: 'assets/q8.jpg',
    hotspots: [
      { id:'q8_a', label:'ê¸€ì„ ì½ê³  ì“¸ ìˆ˜ ìˆëŠ” ëŠ¥ë ¥',         rect: box(5,38,90,8), on:'answer:ê¸€ì„ ì½ê³  ì“¸ ìˆ˜ ìˆëŠ” ëŠ¥ë ¥' },
      { id:'q8_b', label:'ì½ê³  ì´í•´Â·ë¹„íŒÂ·í‘œí˜„í•˜ëŠ” ì¢…í•© ëŠ¥ë ¥', rect: box(5,48,90,8), on:'answer:ì½ê³  ì´í•´Â·ë¹„íŒÂ·í‘œí˜„í•˜ëŠ” ì¢…í•© ëŠ¥ë ¥' },
      { id:'q8_c', label:'ê¸€ìë¥¼ ë§ì´ ì•„ëŠ” ëŠ¥ë ¥',             rect: box(5,59,90,8), on:'answer:ê¸€ìë¥¼ ë§ì´ ì•„ëŠ” ëŠ¥ë ¥' },
      { id:'q8_d', label:'ê¸´ ê¸€ì„ ëê¹Œì§€ ì½ëŠ” ëˆê¸°',           rect: box(5,69,90,8), on:'answer:ê¸´ ê¸€ì„ ëê¹Œì§€ ì½ëŠ” ëˆê¸°' },
    ]
  },

  /* 9) ê²°ê³¼ (ì˜ˆì‹œ: Expression Creator ì´ë¯¸ì§€) */
  {
    id: 'result',
    // ì•„ë˜ëŠ” ê¸°ë³¸ ê²°ê³¼ ì´ë¯¸ì§€. ì‹¤ì œ ê²°ê³¼ì— ë”°ë¼ JSê°€ ë°”ê¿”ì¹˜ê¸° í•¨.
    img: 'assets/result_expression.jpg',
    hotspots: [
      { id:'share',     label:'SHARE',     rect: box(17,80,30,6), on:'share' },
      { id:'restart',   label:'RESTART',   rect: box(53,80,30,6), on:'restart' },
      { id:'instagram', label:'Instagram', rect: box(40,89,8,5),  on:'instagram' },
      { id:'glang',     label:'Glang Logo',rect: box(50,89,8,5),  on:'glang' },
    ]
  }
];

/* --------------------------
   2) ìƒíƒœ & ì§„í–‰
---------------------------*/
const state = {
  index: 0,
  answers: {} // { q1:'x', q2:'ì˜¤ëŠ˜', ... }
};

const $bg = $('#bg');
const $stage = $('#app');
const $toast = $('#toast');

function showToast(msg, t=1100){
  $toast.textContent = msg;
  $toast.classList.add('show');
  setTimeout(()=> $toast.classList.remove('show'), t);
}

function render(){
  const scr = screens[state.index];
  if (!scr) return;

  // ë°°ê²½ ì„¸íŒ…
  $bg.style.backgroundImage = `url("${scr.img}")`;

  // ê¸°ì¡´ í•«ìŠ¤íŒŸ ì œê±°
  $stage.querySelectorAll('.hotspot').forEach(el=>el.remove());

  // í•«ìŠ¤íŒŸ ì£¼ì…
  scr.hotspots.forEach(h=>{
    const btn = document.createElement('button');
    btn.className = 'hotspot';
    btn.setAttribute('aria-label', h.label || h.id);

    // í¼ì„¼íŠ¸ ì¢Œí‘œ -> style
    const {x,y,w,h:hh} = h.rect;
    Object.assign(btn.style, {
      left:  x + '%',
      top:   y + '%',
      width: w + '%',
      height: hh + '%',
      borderRadius: '12px'
    });

    // ì´ë²¤íŠ¸
    btn.addEventListener('click', ()=>handle(h.on));
    $stage.appendChild(btn);
  });
}

function next(){
  state.index++;
  // ì§ˆë¬¸ì„ ëª¨ë‘ ëëƒˆë‹¤ë©´ ê²°ê³¼ë¡œ
  if (state.index >= screens.length - 1) {
    state.index = screens.length - 1;
    // ê²°ê³¼ ì´ë¯¸ì§€ ì„ íƒ
    const resultKey = chooseResult(state.answers);
    const resultImg = resultImageByKey(resultKey);
    screens[state.index].img = resultImg;
  }
  render();
}

function handle(action){
  // on:"answer:ê°’" | "next" | "share" | "restart" | "instagram" | "glang"
  if (!action) return;
  if (action === 'next') { next(); return; }

  if (action.startsWith('answer:')){
    const val = action.split(':')[1];
    const qid = screens[state.index].id; // "q1"~"q8"
    state.answers[qid] = val;
    // // ê°„ë‹¨ í”¼ë“œë°±(ì›í•˜ë©´ ì œê±°)
    // if (correct[qid] !== undefined) {
    //   const ok = correct[qid] === val;
    //   showToast(ok ? 'ğŸ‘ ì •ë‹µ' : 'ì˜¤ë‹µ');
    // }
    next();
    return;
  }

  if (action === 'share') {
    const shareData = {
      title: 'ê¸€ë‘ ë¬¸í•´ë ¥ ë¯¸ë‹ˆ í…ŒìŠ¤íŠ¸',
      text: 'ë‚˜ì˜ ë¬¸í•´ë ¥ ìºë¦­í„°ë¥¼ í™•ì¸í–ˆì–´ìš”! ê¸€ë‘ê³¼ í•¨ê»˜ ì„±ì¥í•´ìš” ğŸ’«',
      url: location.origin + location.pathname
    };
    if (navigator.share) navigator.share(shareData).catch(()=>{});
    else {
      navigator.clipboard?.writeText(shareData.url);
      showToast('ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆì–´ìš”');
    }
    return;
  }

  if (action === 'restart') {
    state.index = 0;
    state.answers = {};
    render();
    return;
  }

  if (action === 'instagram') {
    window.open('https://www.instagram.com/', '_blank', 'noopener');
    return;
  }

  if (action === 'glang') {
    window.open('https://glang.app', '_blank', 'noopener');
    return;
  }
}

/* --------------------------
   3) ê²°ê³¼ ì‚°ì¶œ (ì‹¬í”Œ ë£°, ììœ  êµì²´)
   - ì˜ˆì‹œ: ì •ë‹µ ìˆ˜ ê¸°ë°˜ìœ¼ë¡œ 6ê°œ ê²°ê³¼ì— ë§¤í•‘
   - ì‹¤ì œ ì„œë¹„ìŠ¤ ë£°ë¡œ êµì²´ë§Œ í•˜ë©´ ë¨.
---------------------------*/
function chooseResult(answers){
  // ì •ë‹µ ê°œìˆ˜
  let score = 0;
  Object.keys(correct).forEach(k=>{
    if (answers[k] === correct[k]) score++;
  });

  // 6ê°œ ìœ í˜• ì˜ˆì‹œ ë§¤í•‘
  // (ì›í•˜ëŠ” ë£°ë¡œ ì¬ë§¤í•‘í•˜ì„¸ìš”)
  if (score >= 7) return 'expression';
  if (score === 6) return 'logic';
  if (score === 5) return 'focus';
  if (score === 4) return 'vocab';
  if (score === 3) return 'grammar';
  return 'comp';
}

function resultImageByKey(key){
  const map = {
    expression: 'assets/expression.jpg',
    logic:      'assets/logic.jpg',
    focus:      'assets/focus.jpg',
    vocab:      'assets/vocab.jpg',
    grammar:    'assets/grammar.jpg',
    comp:       'assets/compreh.jpg'
  };
  return map[key] || map.expression;
}

/* --------------------------
   4) ì‹œì‘
---------------------------*/
render();
</script>
</body>
</html>
